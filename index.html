<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valorant Customs Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { 
            background-color: #0a0a0c; 
            color: #ffffff; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            font-size: 16px;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .glass { 
            background: rgba(10, 10, 12, 0.45) !important; 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 16px; 
        }

        .accent { color: #ff4655; }
        th { font-size: 14px; text-transform: uppercase; color: #666; padding: 20px; border-bottom: 2px solid rgba(255,255,255,0.05); }
        td { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 18px; }
        tr:hover { background: rgba(255, 70, 85, 0.08); }

        /* Aurora Background */
        .aurora-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }

        .aurora-glow {
            position: absolute;
            top: -20%;
            right: -10%;
            width: 75vw;
            height: 75vw;
            background: radial-gradient(circle, rgba(255, 70, 85, 0.15) 0%, rgba(147, 51, 234, 0.1) 40%, transparent 70%);
            filter: blur(100px);
            border-radius: 50%;
            animation: auroraMove 25s ease-in-out infinite alternate;
        }

        @keyframes auroraMove {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-10%, 15%) scale(1.1); }
            100% { transform: translate(10%, -10%) scale(1); }
        }

        /* Rank 1 Fire Effect */
        .fire-bg {
            background: linear-gradient(90deg, rgba(255, 70, 85, 0.15) 0%, rgba(10, 10, 12, 0) 50%, rgba(255, 70, 85, 0.05) 100%) !important;
        }

        .fire-particle {
            position: absolute;
            bottom: 5px;
            width: 4px;
            height: 4px;
            background: #ff4655;
            border-radius: 50%;
            filter: blur(1.5px);
            box-shadow: 0 0 10px #ff4655;
            animation: fireFloat 1.5s infinite ease-out;
            z-index: 1;
        }

        @keyframes fireFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-30px) scale(0.3); opacity: 0; }
        }

        /* Shimmer Effect */
        tr::after {
            content: "";
            position: absolute;
            top: 0;
            left: -150%;
            width: 100%; 
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15), transparent);
            transform: skewX(-25deg);
            transition: left 0s; 
            pointer-events: none;
        }

        tr:hover::after {
            left: 50%;
            transition: left 1.5s cubic-bezier(0.19, 1, 0.22, 1); 
        }
    </style>
</head>
<body class="p-6 md:p-12">

    <div class="aurora-container">
        <div class="aurora-glow"></div>
    </div>

    <div id="loading-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-[#0a0a0c]">
        <div class="relative w-24 h-24 mb-8">
            <div class="absolute inset-0 border-4 border-[#ff4655] animate-ping opacity-20"></div>
            <div class="absolute inset-0 border-4 border-[#ff4655] rotate-45 animate-[spin_3s_linear_infinite]"></div>
            <div class="absolute inset-6 bg-[#ff4655] rotate-45 shadow-[0_0_30px_#ff4655]"></div>
        </div>
        <h2 class="text-2xl font-black italic tracking-[0.4em] uppercase text-white animate-pulse">Establishing Connection</h2>
    </div>

    <div id="dashboard-content" class="max-w-[1600px] mx-auto opacity-0 transition-opacity duration-700">
        
        <div id="announcement-bar" class="hidden mb-8 p-4 glass border-l-4 border-[#ff4655] relative overflow-hidden group">
            <div class="flex items-center gap-4">
                <div class="bg-[#ff4655] text-white text-[10px] font-black px-2 py-1 rounded tracking-tighter animate-pulse">LIVE UPDATE</div>
                <div>
                    <span id="announcement-title" class="text-white font-bold uppercase tracking-tighter mr-2 text-xl"></span>
                    <span id="announcement-body" class="text-gray-400 text-lg italic"></span>
                </div>
            </div>
            <div class="absolute inset-0 bg-gradient-to-r from-[#ff465510] to-transparent opacity-20 pointer-events-none"></div>
        </div>

        <header class="mb-12">
            <h1 class="text-5xl font-extrabold italic uppercase tracking-tighter text-white">ChiouCITY <span class="accent">Leaderboards</span></h1>
            <p id="status-text" class="text-gray-500 font-mono text-sm mt-2 uppercase tracking-widest">Initialising Instant Sync...</p>
        </header>

        <div class="overflow-x-auto glass">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player IGN</th>
                        <th>Kills</th>
                        <th>Deaths</th>
                        <th>KD Ratio</th>
                        <th>Wins</th>
                        <th>Loss</th>
                        <th>WR%</th>
                        <th>GP</th>
                        <th>Avg K/G</th>
                        <th>Avg D/G</th>
                        <th>Pi(s)</th>
                        <th>Highest K</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>
    </div>

<script>
const API_KEY = 'AIzaSyBZ6oTJCJUSxCsz_3fbi7lNo-2OP4Y5IDk'; 
const SHEET_ID = '1ALv-N6o8GQ9qvcHR-xKPqaQYEXyqJsItkx2EheCcykc';
const RANGE = "'Leaderboard'!A2:M100"; 

async function init() {
    const status = document.getElementById('status-text');
    
    // Always fetch announcements on refresh
    await fetchAnnouncements(); 

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.values && data.values.length > 0) {
            renderTable(data.values);
            status.innerText = "LIVE // INSTANT API SYNC";
            hideLoader();
        }
    } catch (err) {
        status.innerText = "API CONNECTION FAILED";
    }
}

async function fetchAnnouncements() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Announcements!A1:B1?key=${API_KEY}`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        const bar = document.getElementById('announcement-bar');
        
        if (data.values && data.values[0]) {
            const [title, body] = data.values[0];
            if (title || body) {
                bar.classList.remove('hidden');
                document.getElementById('announcement-title').textContent = title;
                document.getElementById('announcement-body').textContent = body;
                return;
            }
        }
        bar.classList.add('hidden');
    } catch (e) { console.log("No announcements found."); }
}

function renderTable(rows) {
    const lbBody = document.getElementById('leaderboard-body');
    const activeRows = rows.filter(row => row[1] && row[1].toString().trim() !== "");
    const ranked = [];
    const unranked = [];

    activeRows.forEach(row => {
        const rankValue = row[0] ? row[0].toString() : "";
        if (rankValue.includes('?')) unranked.push(row);
        else ranked.push(row);
    });

    ranked.sort((a, b) => (parseFloat(b[4]) || 0) - (parseFloat(a[4]) || 0));

    const getNum = (row, idx) => parseFloat(row[idx]) || 0;
    const getPct = (row, idx) => parseFloat(row[idx] ? row[idx].toString().replace('%','') : 0) || 0;

    const topStats = {
        kills: ranked.length ? Math.max(...ranked.map(r => getNum(r, 2))) : 0,
        deaths: ranked.length ? Math.max(...ranked.map(r => getNum(r, 3))) : 0,
        kd: ranked.length ? Math.max(...ranked.map(r => getNum(r, 4))) : 0,
        wins: ranked.length ? Math.max(...ranked.map(r => getNum(r, 5))) : 0,
        loss: ranked.length ? Math.max(...ranked.map(r => getNum(r, 6))) : 0,
        wr: ranked.length ? Math.max(...ranked.map(r => getPct(r, 7))) : 0,
        gp: ranked.length ? Math.max(...ranked.map(r => getNum(r, 8))) : 0,
        avgK: ranked.length ? Math.max(...ranked.map(r => getNum(r, 9))) : 0,
        hKills: ranked.length ? Math.max(...ranked.map(r => getNum(r, 12))) : 0
    };

    let html = "";
    ranked.forEach((row, i) => html += generateRowHTML(row, `#${i+1}`, "", topStats));
    
    if (unranked.length > 0) {
        html += `<tr><td colspan="13" class="text-center py-8 text-xs font-black uppercase tracking-[0.8em] text-gray-600 italic">â€” Unranked Division â€”</td></tr>`;
        unranked.forEach(row => html += generateRowHTML(row, row[0] || '??', "opacity-40 grayscale unranked-row", topStats));
    }
    lbBody.innerHTML = html;
}

function generateRowHTML(row, rankLabel, cssClass, topStats) {
    const rankNum = parseInt(rankLabel.replace('#', ''));
    const isUnranked = cssClass.includes("opacity-40");
    let specialStyle = "";
    let rankIcon = rankLabel;

    if (!isUnranked) {
        if (rankNum === 1) {
            specialStyle = "gold-gradient animate-gradient border-l-4 border-yellow-500 shadow-[inset_0_0_30px_rgba(255,70,85,0.15)] fire-bg";
            rankIcon = `ðŸ‘‘`;
        } else if (rankNum === 2) rankIcon = `ðŸ¥ˆ`;
        else if (rankNum === 3) rankIcon = `ðŸ¥‰`;
    }

    const getGlow = (val, target, isPct = false, isBadStat = false) => {
        if (isUnranked || !val || target === 0) return '';
        const num = isPct ? parseFloat(val.toString().replace('%','')) : parseFloat(val);
        if (num === target) {
            return isBadStat ? 'text-red-500 font-black drop-shadow-[0_0_12px_rgba(239,68,68,0.8)]' : 'text-yellow-400 font-black drop-shadow-[0_0_12px_rgba(250,204,21,0.8)]';
        }
        return '';
    };

    return `
        <tr class="${cssClass} ${specialStyle} relative overflow-hidden transition-all duration-500 cursor-pointer">
            <td class="py-6 font-bold text-gray-500 italic text-center text-xl">${rankIcon}</td>
            <td class="font-bold uppercase text-white text-2xl tracking-tighter relative">
                ${row[1] || ''}
                ${rankNum === 1 && !isUnranked ? `<span class="text-[10px] bg-[#ff4655] px-2 py-0.5 rounded ml-2">GOAT</span>` : ''}
            </td>
            <td class="text-xl ${getGlow(row[2], topStats.kills)}">${row[2] || '0'}</td>
            <td class="text-xl ${getGlow(row[3], topStats.deaths, false, true)}">${row[3] || '0'}</td>
            <td class="accent font-black italic text-5xl ${getGlow(row[4], topStats.kd)}">${row[4] || '0.00'}</td>
            <td class="text-xl text-green-500 font-bold ${getGlow(row[5], topStats.wins)}">${row[5] || '0'}</td>
            <td class="text-xl text-red-500 font-bold ${getGlow(row[6], topStats.loss, false, true)}">${row[6] || '0'}</td>
            <td class="text-xl ${getGlow(row[7], topStats.wr, true)} font-bold">${row[7] || '0%'}</td>
            <td class="text-xl text-gray-400 font-mono">${row[8] || '0'}</td>
            <td class="text-xl">${row[9] || '0'}</td>
            <td class="text-xl">${row[10] || '0'}</td>
            <td class="text-xl">${row[11] || '0'}</td>
            <td class="text-xl font-bold text-blue-400 italic">${row[12] || '0'}</td>
        </tr>
    `;
}

function hideLoader() {
    const loader = document.getElementById('loading-screen');
    const content = document.getElementById('dashboard-content');
    loader.style.opacity = '0';
    setTimeout(() => {
        loader.style.display = 'none';
        content.classList.remove('opacity-0');
    }, 500);
}

init();
setInterval(init, 15000);
</script>
</body>
</html>
