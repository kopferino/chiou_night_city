<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel | Private Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>

	select {
    		background-color: #0a0a0c !important; /* Black background */
    		color: #ffffff !important;           /* White text */
    		border: 1px solid rgba(255, 70, 85, 0.5); 
    		padding: 8px;
    		border-radius: 8px;
    		cursor: pointer;
    		outline: none;
	}

	select option {
    		background-color: #1a1a1e !important; /* Dark grey/black background */
    		color: #ffffff !important;           /* White text */
    		padding: 10px;
	}

	select option:hover {
    		background-color: #ff4655 !important; 
    		color: white !important;
	}	

        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #0a0a0c; color: #ffffff; font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; }
        .accent { color: #ff4655; }
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">

    <div id="password-gate" class="fixed inset-0 z-[200] bg-[#0a0a0c] flex items-center justify-center p-6">
        <div class="glass max-w-md w-full p-10 text-center border-[#ff4655]/20 shadow-[0_0_50px_rgba(255,70,85,0.1)]">
            <h2 class="text-2xl font-black uppercase tracking-tighter mb-8 italic">Restricted <span class="accent">Access</span></h2>
            <input type="password" id="pass-input" placeholder="MODERATOR PASSWORD" 
                   class="w-full bg-white/5 border border-white/10 p-4 rounded text-white text-center text-xl outline-none focus:border-[#ff4655] mb-4">
            <button onclick="checkPassword()" class="w-full bg-[#ff4655] text-white p-4 rounded font-bold uppercase tracking-widest hover:scale-[1.02] transition">Unlock Tools</button>
            <p id="pass-error" class="text-[#ff4655] text-[10px] mt-4 uppercase font-bold hidden">Invalid Password</p>
        </div>
    </div>

    <div id="admin-ui" class="hidden glass max-w-2xl w-full p-10 opacity-0 transition-opacity duration-500">
        <h2 class="text-4xl font-black italic uppercase mb-2 tracking-tighter">Moderator <span class="accent">Tools</span></h2>
        <p id="status-text" class="text-gray-500 font-mono text-xs mb-8 uppercase tracking-widest">Initialising API Sync...</p>

        <div class="space-y-8">
		<div class="p-6 border border-white/5 rounded-xl bg-white/[0.01]">
    			<label class="block text-xs uppercase text-gray-400 mb-4 font-bold tracking-widest italic">3. Live Announcement</label>
    			<div class="space-y-4">
        			<input type="text" id="news-title" placeholder="HEADER (e.g., SYSTEM UPDATE)" 
               		class="w-full bg-white/5 border border-white/10 p-4 rounded text-white text-lg outline-none focus:border-[#ff4655]">
        			<textarea id="news-body" placeholder="MESSAGE CONTENT..." rows="2" 
               		class="w-full bg-white/5 border border-white/10 p-4 rounded text-white text-lg outline-none focus:border-[#ff4655] resize-none"></textarea>
    		</div>
    		<div class="grid grid-cols-2 gap-4 mt-4">
        		<button onclick="submitNews()" class="bg-[#ff4655] text-white p-4 rounded font-black italic uppercase hover:scale-[1.02] transition">Publish News</button>
        		<button onclick="clearNews()" class="bg-white/10 text-white p-4 rounded font-black italic uppercase hover:bg-white/20 transition text-xs">Clear News</button>
    		</div>
		</div>
            <div>
                <label class="block text-xs uppercase text-gray-500 mb-2 font-bold">Select Player</label>
                <select id="player-select" class="w-full bg-white/10 border border-white/10 p-4 rounded text-white text-lg outline-none focus:border-[#ff4655] cursor-pointer"></select>
            </div>

            <div class="p-6 border border-white/5 rounded-xl bg-white/[0.01]">
                <label class="block text-xs uppercase text-gray-400 mb-4 font-bold tracking-widest italic">1. Update Combat Stats</label>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <input type="number" id="add-kills" placeholder="KILLS TO ADD" class="bg-white/5 border border-white/10 p-4 rounded text-white text-lg outline-none focus:border-[#ff4655]">
                    <input type="number" id="add-deaths" placeholder="DEATHS TO ADD" class="bg-white/5 border border-white/10 p-4 rounded text-white text-lg outline-none focus:border-[#ff4655]">
                </div>
                <button onclick="submitStats()" class="w-full bg-white text-black p-4 rounded font-black italic uppercase hover:bg-[#ff4655] hover:text-white transition">Confirm Score Update</button>
            </div>

            <div class="p-6 border border-white/5 rounded-xl bg-white/[0.01]">
                <label class="block text-xs uppercase text-gray-400 mb-4 font-bold tracking-widest italic">2. Match Outcome</label>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="space-y-2">
                        <button onclick="submitResult('win')" class="w-full bg-green-600/20 border border-green-500/30 p-4 rounded font-bold hover:bg-green-600/40 text-green-400 uppercase italic">Add Win</button>
                        <button onclick="submitResult('remove-win')" class="w-full text-[9px] uppercase text-gray-600 hover:text-white tracking-widest transition">Undo Win</button>
                    </div>
                    <div class="space-y-2">
                        <button onclick="submitResult('loss')" class="w-full bg-red-600/20 border border-red-500/30 p-4 rounded font-bold hover:bg-red-600/40 text-red-400 uppercase italic">Add Loss</button>
                        <button onclick="submitResult('remove-loss')" class="w-full text-[9px] uppercase text-gray-600 hover:text-white tracking-widest transition">Undo Loss</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- CONFIGURATION ---
    const ADMIN_PASSWORD = "nicholasdiddyko123@gmail.com"; // Change this!
    const API_KEY = "AIzaSyBZ6oTJCJUSxCsz_3fbi7lNo-2OP4Y5IDk";
    const SHEET_ID = "1ALv-N6o8GQ9qvcHR-xKPqaQYEXyqJsItkx2EheCcykc";
    const RANGE = "'Leaderboard'!A2:B100"; // We only need Rank and IGN for the dropdown
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxf4qbhQlSPa4UCbGzZEjf-QoMgJ_JTh0ySPfXgMbRVyfN7K3oZoL0tHY1CgpAorBPh/exec";

    // --- PASSWORD LOGIC ---
    function checkPassword() {
        if (document.getElementById('pass-input').value === ADMIN_PASSWORD) {
            document.getElementById('password-gate').style.display = 'none';
            document.getElementById('admin-ui').classList.remove('hidden');
            setTimeout(() => document.getElementById('admin-ui').classList.remove('opacity-0'), 10);
            loadPlayers();
        } else {
            document.getElementById('pass-error').classList.remove('hidden');
        }
    }

    // --- API SYNC (Loads players into dropdown) ---
    async function loadPlayers() {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data.values) {
                // Filter rows where IGN (column index 1) exists
                document.getElementById('player-select').innerHTML = data.values
                    .filter(r => r[1])
                    .map(r => `<option value="${r[1]}">${r[1]}</option>`)
                    .join('');
                document.getElementById('status-text').innerText = "Database Linked // Ready";
            }
        } catch (e) {
            document.getElementById('status-text').innerText = "API Error: Sync Failed";
        }
    }

    // --- SUBMISSION LOGIC (Sends to App Script) ---
    async function sendToSheet(payload) {
        const status = document.getElementById('status-text');
        status.innerText = "SENDING DATA...";
        try {
            // Note: 'no-cors' mode is used for App Script posts
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            status.innerText = "SUCCESS: SHEET UPDATED";
            setTimeout(() => status.innerText = "DATABASE LINKED // READY", 3000);
        } catch (e) {
            status.innerText = "ERROR: UPDATE FAILED";
        }
    }

    function submitStats() {
        const kills = document.getElementById('add-kills').value || 0;
        const deaths = document.getElementById('add-deaths').value || 0;
        sendToSheet({
            type: 'stats',
            player: document.getElementById('player-select').value,
            kills: kills,
            deaths: deaths
        });
        document.getElementById('add-kills').value = "";
        document.getElementById('add-deaths').value = "";
    }

    function submitResult(res) {
        sendToSheet({
            type: 'result',
            player: document.getElementById('player-select').value,
            result: res
        });
    }

    function submitNews() {
    	const title = document.getElementById('news-title').value;
    	const body = document.getElementById('news-body').value;
    
    	if (!title && !body) {
        	alert("Please enter a title or a message.");
        	return;
    	}
    
    	sendToSheet({
        	type: 'announcement',
        	title: title,
        	body: body
    	});
	}

	function clearNews() {
    		if (confirm("This will remove the announcement from the website. Continue?")) {
        	sendToSheet({ 
            	type: 'announcement', 
            	title: '', 
            	body: '' 
        	});
        	document.getElementById('news-title').value = "";
        	document.getElementById('news-body').value = "";
    		}
	}

    // Enter key support
    document.getElementById('pass-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') checkPassword(); });
</script>
</body>
</html>
